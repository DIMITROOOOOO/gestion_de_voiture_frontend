<div class="container mt-4">
  <h2 class="mb-4">Manage Drivers</h2>

  <button class="btn btn-primary mb-3" (click)="openModal('addChauffeurModal')">Add Driver</button>

  <div class="card mb-4">
    <div class="card-header">
      <h3>Drivers</h3>
    </div>
    <div class="card-body">
      <table class="table table-striped">
        <thead>
          <tr>
            <th>ID</th>
            <th>Name</th>
            <th>Phone</th>
            <th>License Number</th>
            <th>Hire Date</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let chauffeur of chauffeurs">
            <td>{{ chauffeur.chauffeur_id }}</td>
            <td>{{ chauffeur.nom }}</td>
            <td>{{ chauffeur.telephone }}</td>
            <td>{{ chauffeur.numero_permis }}</td>
            <td>{{ chauffeur.date_embauche | date }}</td>
            <td>{{ chauffeur.statutChaffeurs }}</td>
            <td>
              <button class="btn btn-warning btn-sm me-2" (click)=" openEditModal(chauffeur)">Edit</button>
              <button class="btn btn-danger btn-sm" (click)="openDeleteModal(chauffeur)">Delete</button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <div class="card">
    <div class="card-header">
      <h3>Available Vehicles</h3>
    </div>
    <div class="card-body">
      <table class="table table-striped">
        <thead>
          <tr>
            <th>ID</th>
            <th>Brand</th>
            <th>Model</th>
            <th>License Plate</th>
            <th>Status</th>
            <th>Assign to Driver</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let vehicle of availableVehicles">
            <td>{{ vehicle.vehicule_id }}</td>
            <td>{{ vehicle.marque }}</td>
            <td>{{ vehicle.modele }}</td>
            <td>{{ vehicle.plaque_immatriculation }}</td>
            <td>{{ vehicle.statut }}</td>
            <td>
              <button class="btn btn-success btn-sm" (click)="setSelectedVehicle(vehicle); openModal('assignVehicleModal')">
                Assign
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>

<div *ngIf="showAddChauffeurModal" class="modal fade show" tabindex="-1" style="display: block;">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Add Chauffeur</h5>
        <button type="button" class="btn-close" (click)="closeModal('addChauffeurModal')"></button>
      </div>
      <div class="modal-body">
        <form (ngSubmit)="addChauffeur()">
          <div class="mb-3">
            <label for="nom" class="form-label">Name:</label>
            <input id="nom" class="form-control" [(ngModel)]="currentChauffeur.nom" name="nom" required />
          </div>
          <div class="mb-3">
            <label for="telephone" class="form-label">Phone:</label>
            <input id="telephone" class="form-control" [(ngModel)]="currentChauffeur.telephone" name="telephone" required />
          </div>
          <div class="mb-3">
            <label for="numero_permis" class="form-label">License Number:</label>
            <input id="numero_permis" class="form-control" [(ngModel)]="currentChauffeur.numero_permis" name="numero_permis" required />
          </div>
          <div class="mb-3">
            <label for="date_embauche" class="form-label">Hire Date:</label>
            <input id="date_embauche" type="date" class="form-control" [(ngModel)]="currentChauffeur.date_embauche" name="date_embauche" required />
          </div>
          <div class="mb-3">
            <label for="statutChaffeurs" class="form-label">Status:</label>
            <select id="statutChaffeurs" class="form-select" [(ngModel)]="currentChauffeur.statutChaffeurs" name="statutChaffeurs" required>
              <option *ngFor="let status of getDriverStatutValues()" [value]="status">{{ status }}</option>
            </select>
          </div>
          <button type="submit" class="btn btn-primary">Add</button>
          <button type="button" class="btn btn-secondary" (click)="closeModal('addChauffeurModal')">Cancel</button>
        </form>
      </div>
    </div>
  </div>
</div>

<div *ngIf="showAssignVehicleModal" class="modal fade show" tabindex="-1" style="display: block;">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Assign Vehicle</h5>
        <button type="button" class="btn-close" (click)="closeModal('assignVehicleModal')"></button>
      </div>
      <div class="modal-body">
        <form (ngSubmit)="assignChauffeurToVehicle()">
          <div class="mb-3">
            <label for="chauffeurSelect" class="form-label">Select Chauffeur:</label>
            <select id="chauffeurSelect" class="form-select" [(ngModel)]="selectedChauffeurId" name="chauffeurSelect" required>
              <option *ngFor="let chauffeur of availableChauffeurs" [value]="chauffeur.chauffeur_id">
                {{ chauffeur.nom }} (ID: {{ chauffeur.chauffeur_id }})
              </option>
            </select>
          </div>
          <button type="submit" class="btn btn-primary">Assign</button>
          <button type="button" class="btn btn-secondary" (click)="closeModal('assignVehicleModal')">Cancel</button>
        </form>
      </div>
    </div>
  </div>
</div>

<div *ngIf="showEditChauffeurModal" class="modal fade show" tabindex="-1" style="display: block;">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Edit Chauffeur</h5>
        <button type="button" class="btn-close" (click)="closeModal('editChauffeurModal')"></button>
      </div>
      <div class="modal-body">
        <form (ngSubmit)="updateChauffeur()">
          <div class="mb-3">
            <label for="editNom" class="form-label">Name:</label>
            <input id="editNom" class="form-control" [(ngModel)]="currentChauffeur.nom" name="nom" required />
          </div>
          <div class="mb-3">
            <label for="editTelephone" class="form-label">Phone:</label>
            <input id="editTelephone" class="form-control" [(ngModel)]="currentChauffeur.telephone" name="telephone" required />
          </div>
          <div class="mb-3">
            <label for="editNumeroPermis" class="form-label">License Number:</label>
            <input id="editNumeroPermis" class="form-control" [(ngModel)]="currentChauffeur.numero_permis" name="numero_permis" required />
          </div>
          <div class="mb-3">
            <label for="editDateEmbauche" class="form-label">Hire Date:</label>
            <input id="editDateEmbauche" type="date" class="form-control" [(ngModel)]="currentChauffeur.date_embauche" name="date_embauche" required />
          </div>
          <div class="mb-3">
            <label for="editStatutChaffeurs" class="form-label">Status:</label>
            <select id="editStatutChaffeurs" class="form-select" [(ngModel)]="currentChauffeur.statutChaffeurs" name="statutChaffeurs" required>
              <option *ngFor="let status of getDriverStatutValues()" [value]="status">{{ status }}</option>
            </select>
          </div>
          <button type="submit" class="btn btn-primary">Update</button>
          <button type="button" class="btn btn-secondary" (click)="closeModal('editChauffeurModal')">Cancel</button>
        </form>
      </div>
    </div>
  </div>
</div>

<div *ngIf="showDeleteChauffeurModal" class="modal fade show" tabindex="-1" style="display: block;">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Delete Chauffeur</h5>
        <button type="button" class="btn-close" (click)="closeModal('deleteChauffeurModal')"></button>
      </div>
      <div class="modal-body">
        <p>Are you sure you want to delete this chauffeur?</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="closeModal('deleteChauffeurModal')">Cancel</button>
        <button type="button" class="btn btn-danger" (click)="deleteChauffeur(currentChauffeur.chauffeur_id)">Delete</button>
      </div>
    </div>
  </div>
</div>